{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Event",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique ID for the event",
      "ui": { "widget": "hidden" }
    },
    "slug": {
      "type": "string",
      "ui": { "widget": "text", "label": "ID/Slug" }
    },
    "title": {
      "type": "string",
      "description": "Internal title for the event",
      "ui": { "widget": "text", "label": "Title" }
    },
    "type": {
      "type": "string",
      "description": "Type of event logic",
      "enum": ["Encounter", "ItemReward", "LoreDiscovery", "Dialogue", "Teleport", "ScriptedScene"],
      "ui": {
        "widget": "select",
        "label": "Event Type",
        "options": ["Encounter", "ItemReward", "LoreDiscovery", "Dialogue", "Teleport", "ScriptedScene"]
      }
    },
    "requirements_id": {
      "type": "string",
      "description": "Requirement to unlock this event",
      "ui": {
        "widget": "reference",
        "reference": "requirements",
        "label": "Requirements"
      }
    },
    "location_id": {
      "type": "string",
      "description": "Optional: location where this event occurs",
      "ui": {
        "widget": "reference",
        "reference": "locations",
        "label": "Location"
      }
    },
    "lore_id": {
      "type": "string",
      "description": "Required if type = LoreDiscovery",
      "ui": {
        "widget": "reference",
        "reference": "lore_entries",
        "label": "Lore Entry"
      }
    },
    "dialogue_id": {
      "type": "string",
      "description": "Required if type = Dialogue",
      "ui": {
        "widget": "reference",
        "reference": "dialogues",
        "label": "Dialogue"
      }
    },
    "encounter_id": {
      "type": "string",
      "description": "Required if type = Encounter",
      "ui": {
        "widget": "reference",
        "reference": "encounters",
        "label": "Encounter"
      }
    },
    "item_rewards": {
      "type": "array",
      "description": "If type = ItemReward, the items given",
      "items": {
        "type": "object",
        "properties": {
          "item_id": {
            "type": "string",
            "ui": {
              "widget": "reference",
              "reference": "items",
              "label": "Item"
            }
          },
          "quantity": {
            "type": "number",
            "ui": { "widget": "number", "label": "Quantity" }
          }
        },
        "required": ["item_id", "quantity"]
      }
    },
    "xp_reward": {
      "type": "number",
      "description": "XP granted after completing the event",
      "ui": { "widget": "number", "label": "Experience" }
    },
    "currency_rewards": {
      "type": "array",
      "description": "Currencies granted when the event resolves",
      "items": {
        "type": "object",
        "properties": {
          "currency_id": {
            "type": "string",
            "ui": {
              "widget": "reference",
              "reference": "currencies",
              "label": "Currency"
            }
          },
          "amount": {
            "type": "number",
            "ui": { "widget": "number", "label": "Amount" }
          }
        },
        "required": ["currency_id", "amount"]
      }
    },
    "reputation_rewards": {
      "type": "array",
      "description": "Faction reputation adjustments applied",
      "items": {
        "type": "object",
        "properties": {
          "faction_id": {
            "type": "string",
            "ui": {
              "widget": "reference",
              "reference": "factions",
              "label": "Faction"
            }
          },
          "amount": {
            "type": "number",
            "description": "Positive or negative reputation delta",
            "ui": { "widget": "number", "label": "Delta" }
          }
        },
        "required": ["faction_id", "amount"]
      }
    },
    "flags_set": {
      "type": "array",
      "description": "Flags that will be set when the event completes",
      "items": { "type": "string" },
      "ui": {
        "widget": "multiselect",
        "label": "Flags Set",
        "reference": "flags"
      }
    },
    "next_event_id": {
      "type": "string",
      "description": "Optional next event triggered automatically after this one",
      "ui": {
        "widget": "reference",
        "reference": "events",
        "label": "Next Event"
      }
    },
    "tags": {
      "type": "array",
      "description": "Tags for filtering/searching/categorisation",
      "items": { "type": "string" },
      "ui": { "widget": "tags", "label": "Tags" }
    }
  },
  "required": ["id", "slug", "title", "type"]
}
