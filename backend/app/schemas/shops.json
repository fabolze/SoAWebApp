{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Shop",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique ID for the shop",
      "ui": {
        "widget": "hidden"
      }
    },
    "slug": {
      "type": "string",
      "ui": {
        "widget": "text",
        "label": "ID/Slug"
      }
    },
    "name": {
      "type": "string",
      "description": "Display name of the shop",
      "ui": {
        "widget": "text",
        "label": "Shop Name"
      }
    },
    "description": {
      "type": "string",
      "description": "Optional flavor text for the shop",
      "ui": {
        "widget": "textarea",
        "label": "Description"
      }
    },
    "price_modifier": {
      "type": "number",
      "description": "Flat price adjustment applied to every item in this shop",
      "ui": {
        "widget": "number",
        "label": "Base Price Modifier"
      }
    },
    "price_multiplier": {
      "type": "number",
      "description": "Multiplicative price adjustment applied to every item in this shop",
      "ui": {
        "widget": "number",
        "label": "Base Price Multiplier",
        "placeholder": "1.0"
      }
    },
    "price_override": {
      "type": "number",
      "description": "Optional absolute price to charge for all items (applied before inventory overrides)",
      "ui": {
        "widget": "number",
        "label": "Global Price Override"
      }
    },
    "currency_id": {
      "type": "string",
      "description": "Optional override currency for this shop",
      "ui": {
        "widget": "reference",
        "reference": "currencies",
        "label": "Default Currency"
      }
    },
    "location_id": {
      "type": "string",
      "description": "Location where the shop exists",
      "ui": {
        "widget": "reference",
        "label": "Location",
        "reference": "locations"
      }
    },
    "npc_id": {
      "type": "string",
      "description": "Optional: NPC running the shop",
      "ui": {
        "widget": "reference",
        "label": "Shopkeeper (NPC)",
        "reference": "npcs"
      }
    },
    "requirements_id": {
      "type": "string",
      "description": "Requirement to unlock this shop",
      "ui": {
        "widget": "reference",
        "reference": "requirements",
        "label": "Requirements"
      }
    },
    "inventory": {
      "type": "array",
      "description": "Items for sale",
      "items": {
        "type": "object",
        "properties": {
          "item_id": {
            "type": "string",
            "description": "Item being sold",
            "ui": {
              "widget": "reference",
              "label": "Item",
              "reference": "items"
            }
          },
          "stock": {
            "type": "number",
            "description": "Optional: stock limit (null = infinite)",
            "ui": {
              "widget": "number",
              "label": "Stock"
            }
          },
          "requirements_id": {
            "type": "string",
            "description": "Requirement to purchase this item",
            "ui": {
              "widget": "reference",
              "reference": "requirements",
              "label": "Requirements"
            }
          },
          "price_modifier": {
            "type": "number",
            "description": "Flat adjustment applied after shop-level math",
            "ui": {
              "widget": "number",
              "label": "Entry Modifier"
            }
          },
          "price_multiplier": {
            "type": "number",
            "description": "Multiplier applied after shop-level math",
            "ui": {
              "widget": "number",
              "label": "Entry Multiplier",
              "placeholder": "1.0"
            }
          },
          "price_override": {
            "type": "number",
            "description": "Optional absolute price for this entry",
            "ui": {
              "widget": "number",
              "label": "Entry Override"
            }
          },
          "currency_id": {
            "type": "string",
            "description": "Optional currency override for this inventory entry",
            "ui": {
              "widget": "reference",
              "reference": "currencies",
              "label": "Entry Currency"
            }
          }
        },
        "required": [
          "item_id"
        ]
      },
      "ui": {
        "widget": "item_price_table",
        "label": "Inventory"
      }
    },
    "price_modifiers": {
      "type": "array",
      "description": "Dynamic pricing rules",
      "items": {
        "type": "object",
        "properties": {
          "modifier_type": {
            "type": "string",
            "enum": [
              "FactionReputation",
              "Flag",
              "QuestState"
            ],
            "ui": {
              "widget": "select",
              "label": "Modifier Type",
              "options": [
                "FactionReputation",
                "Flag",
                "QuestState"
              ]
            }
          },
          "reference_id": {
            "type": "string",
            "description": "Reference flag ID (for Flag modifiers)",
            "ui": {
              "widget": "reference",
              "reference": "flags",
              "label": "Reference Flag"
            }
          },
          "operator": {
            "type": "string",
            "enum": [
              "gte",
              "eq",
              "lte"
            ],
            "description": "Comparison operator"
          },
          "value": {
            "type": "number",
            "description": "Threshold value for triggering modifier"
          },
          "price_multiplier": {
            "type": "number",
            "description": "Price multiplier to apply"
          }
        }
      }
    },
    "tags": {
      "type": "array",
      "description": "Tags for filtering/searching/categorization",
      "items": {
        "type": "string"
      },
      "ui": {
        "widget": "tags",
        "label": "Tags"
      }
    }
  },
  "required": [
    "id",
    "slug",
    "name",
    "inventory"
  ]
}
